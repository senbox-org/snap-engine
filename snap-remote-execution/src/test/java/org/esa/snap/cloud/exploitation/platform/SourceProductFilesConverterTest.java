package org.esa.snap.cloud.exploitation.platform;

import com.bc.ceres.binding.ConversionException;
import org.esa.snap.remote.execution.converters.SourceProductFilesConverter;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

/**
 * Created by jcoravu on 15/3/2019.
 */
public class SourceProductFilesConverterTest {

    public SourceProductFilesConverterTest() {
    }

    @Test
    public void testParseRemoteMachines() throws ConversionException {
        StringBuilder text = new StringBuilder();
        text.append("<file path='\\\\192.168.240.65\\shared\\3_8bit_components_srgb.tif' />");
        text.append("<file path='\\\\192.168.240.65\\shared\\deimos.dm' />");

        SourceProductFilesConverter converter = new SourceProductFilesConverter();
        String[] sourceFilesParsed = converter.parse(text.toString());
        assertNotNull(sourceFilesParsed);
        assertEquals(2, sourceFilesParsed.length);

        assertNotNull(sourceFilesParsed[0]);
        assertEquals("\\\\192.168.240.65\\shared\\3_8bit_components_srgb.tif", sourceFilesParsed[0]);

        assertNotNull(sourceFilesParsed[1]);
        assertEquals("\\\\192.168.240.65\\shared\\deimos.dm", sourceFilesParsed[1]);
    }

    @Test
    public void testFormatAndParseRemoteMachines() throws ConversionException {
        String[] sourceFilesFormatted = new String[3];
        sourceFilesFormatted[0] = "D:\\snap\\products\\deimos.dm";
        sourceFilesFormatted[1] = "/home/user/snap/input/gdalProduct.hdr";
        sourceFilesFormatted[2] = "c:/products/sentinel2/sample.dim";

        SourceProductFilesConverter converter = new SourceProductFilesConverter();

        String text = converter.format(sourceFilesFormatted);
        assertNotNull(text);

        String[] sourceFilesParsed = converter.parse(text);
        assertNotNull(sourceFilesParsed);
        assertEquals(3, sourceFilesParsed.length);

        assertNotNull(sourceFilesParsed[0]);
        assertEquals("D:\\snap\\products\\deimos.dm", sourceFilesParsed[0]);

        assertNotNull(sourceFilesParsed[1]);
        assertEquals("/home/user/snap/input/gdalProduct.hdr", sourceFilesParsed[1]);

        assertNotNull(sourceFilesParsed[2]);
        assertEquals("c:/products/sentinel2/sample.dim", sourceFilesParsed[2]);
    }
}
